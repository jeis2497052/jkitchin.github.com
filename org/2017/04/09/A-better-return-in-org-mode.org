* DONE A better return in org-mode
  CLOSED: [2017-04-09 Sun 10:56]
  :PROPERTIES:
  :categories: emacs,orgmode
  :date:     2017/04/09 10:56:42
  :updated:  2017/04/09 18:56:32
  :END:

Over on [[http://emacs.stackexchange.com/questions/24574/org-mode-default-to-alt-enter-for-bullets][Stackoverflow]] someone wanted a better return in org-mode. They wanted return to add items in a list (instead of M-Ret).	Someone posted a partial solution, and here I improve on it to add new items to lists, new headings after a heading, and new rows to tables. In each case, a double return on an empty item, headline or table row will delete that line, and terminate the list, headlines or table. You can still use M-Ret, and this function falls through to org-return like it did before.

Here is the function. Give it a try. It is a small but helpful addition I think. I have not used it for long, so if you come across issues leave a comment!

#+BEGIN_SRC emacs-lisp
(defun scimax/org-return ()
  "Add new list or headline "
  (interactive)
  (cond
   ((org-in-item-p)
    (if (org-element-property :contents-begin (org-element-context))
	(org-insert-heading)
      (beginning-of-line)
      (setf (buffer-substring
	     (line-beginning-position) (line-end-position)) "")
      (org-return)))
   ((org-at-heading-p)
    (if (not (string= "" (org-element-property :title (org-element-context))))
	(progn (org-end-of-meta-data)
	       (org-insert-heading))
      (beginning-of-line)
      (setf (buffer-substring
	     (line-beginning-position) (line-end-position)) "")))
   ((org-at-table-p)
    (if (-any?
	 (lambda (x) (not (string= "" x)))
	 (nth
	  (- (org-table-current-dline) 1)
	  (org-table-to-lisp)))
	(org-return)
      ;; empty row
      (beginning-of-line)
      (setf (buffer-substring
	     (line-beginning-position) (line-end-position)) "")
      (org-return)))
   (t
    (org-return))))

(define-key org-mode-map (kbd "RET")
  'scimax/org-return)
#+END_SRC

#+RESULTS:
: scimax/org-return
