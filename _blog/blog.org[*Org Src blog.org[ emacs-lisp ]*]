(defmacro with-dict (key-vals &rest body)
  (let ((g (if (symbolp key-vals)
	       (symbol-value key-vals)
	     key-vals)))
    `(labels ,(loop for key in (-slice ,g
				       0 nil 2)
		    collect
		    (list key '() `(plist-get ',g  ,key)))
       ,@body)))

(with-dict (:a 1 :b 'some-symbol :c 3)
	   (:b))

(macroexpand '(with-dict (:a 1 :b 'some-symbol :c 3)
			 (:b)))

(let ((d '(:a 1 :b 'some-symbol :c 3)))
  (with-dict d (:b)))
